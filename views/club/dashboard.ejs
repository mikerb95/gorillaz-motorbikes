<%- include('../partials/head', { title: 'Club — Panel', user }) %>

<% if (user && user.role === 'admin') { %>
  <div class="container">
    <div class="admin-top">
      <span class="muted">Usuario administrador</span>
      <a class="btn btn-sm" href="/admin">Ir al panel de administrador</a>
    </div>
  </div>
<% } %>

<section>
  <h1>Hola, <%= user.name %></h1>
  <div class="grid two">
    <div class="card">
      <h2>Tu membresía</h2>
      <p><strong>Nivel:</strong> <%= user.membership.level %></p>
      <p><strong>Desde:</strong> <%= user.membership.since %></p>
      <p><strong>Vence:</strong> <%= user.membership.expires %></p>
      <h3>Beneficios</h3>
      <ul>
        <% user.membership.benefits.forEach(b => { %>
          <li><%= b %></li>
        <% }) %>
      </ul>
    </div>
    <div class="card">
      <h2>Historial de visitas</h2>
      <ul class="list">
        <% if (user.visits.length === 0) { %>
          <li class="muted">Sin registros aún.</li>
        <% } %>
        <% user.visits.forEach(v => { %>
          <li>
            <span><strong><%= v.date %></strong></span>
            <span><%= v.service %></span>
          </li>
        <% }) %>
      </ul>
      <form class="stack" method="post" action="/club/visitas">
        <label>
          Fecha
          <input type="date" name="date" required />
        </label>
        <label>
          Servicio
          <input type="text" name="service" placeholder="Descripción del servicio" required />
        </label>
        <button class="btn" type="submit">Agregar visita</button>
      </form>
    </div>
  </div>
</section>

<section>
  <div class="grid two">
    <div class="card">
      <h2>Recordatorios SOAT y Tecnomecánica</h2>
      <% if (!reminders || reminders.length === 0) { %>
        <p class="muted">Aún no has registrado vehículos.</p>
      <% } else { %>
        <ul class="list">
        <% reminders.forEach(r => { %>
          <li>
            <span><strong><%= r.plate %></strong></span>
            <span>
              SOAT: <%= r.soat === null ? '—' : (r.soat < 0 ? ('Vencido hace ' + Math.abs(r.soat) + ' días') : ('en ' + r.soat + ' días')) %>
              &nbsp;|&nbsp;
              Tecno: <%= r.tecno === null ? '—' : (r.tecno < 0 ? ('Vencida hace ' + Math.abs(r.tecno) + ' días') : ('en ' + r.tecno + ' días')) %>
            </span>
          </li>
        <% }) %>
        </ul>
      <% } %>
    </div>
    <div class="card">
      <h2>Mis vehículos</h2>
      <form class="stack" method="post" action="/club/vehiculos">
        <label>Placa<input name="plate" maxlength="8" placeholder="ABC123" required /></label>
        <div class="grid two" style="align-items:end">
          <label>Vence SOAT<input type="date" name="soatExpires" style="min-width:0" /></label>
          <label>Vence Tecno<input type="date" name="tecnoExpires" style="min-width:0" /></label>
        </div>
        <button class="btn" type="submit">Agregar</button>
      </form>
      <% if (user.vehicles && user.vehicles.length) { %>
        <ul class="list list-actions" style="margin-top:10px">
          <% user.vehicles.forEach(v => { %>
            <li>
              <span><%= v.plate %></span>
              <form method="post" action="/club/vehiculos/eliminar" data-confirm="¿Eliminar vehículo?">
                <input type="hidden" name="plate" value="<%= v.plate %>" />
                <button class="btn btn-xs btn-outline" type="submit">Eliminar</button>
              </form>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>
  </div>
  </section>

<%- include('../partials/footer') %>
